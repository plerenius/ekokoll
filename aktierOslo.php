<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><?phprequire_once('Connections/localhost_lerenius.php');require_once("Connections/pdo_connect.php");
function GetSQLValueString($theValue, $theType, $theDefinedValue = "", $theNotDefinedValue = "") {  $theValue = (!get_magic_quotes_gpc()) ? addslashes($theValue) : $theValue;  switch ($theType) {    case "text":      $theValue = ($theValue != "") ? "'" . $theValue . "'" : "NULL";      break;        case "long":    case "int":      $theValue = ($theValue != "") ? intval($theValue) : "NULL";      break;    case "double":      $theValue = strtr($theValue,',','.');      $theValue = ($theValue != "") ? "'" . doubleval($theValue) . "'" : "NULL";      break;    case "date":      $theValue = ($theValue != "") ? "'" . $theValue . "'" : "NULL";      break;    case "defined":      $theValue = ($theValue != "") ? $theDefinedValue : $theNotDefinedValue;      break;  }  return $theValue;}
$stocks_sql ="SELECT s.id, s.name, sv.value FROM p_ekon_stocks AS s";$stocks_sql.=" LEFT JOIN (SELECT * FROM p_ekon_stockvalues WHERE DATE(`time`)=DATE(NOW())) AS sv ON sv.stock_id = s.id";$stocks_sql.=" WHERE ISNULL(sv.value) AND s.market='NOR' ORDER BY name";$statement_1 = $db->query($stocks_sql);if(!$statement_1){  die("Execute query error, because: ". $db->errorInfo());}?><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Aktiekurser Oslo</title><link href="biscaya.css" rel="stylesheet" type="text/css" /></head><body><h1>Aktiekurs Oslo</h1><?phpif (date("H") < 18) { echo "<p><strong>\n"; echo "Klockan &auml;r " . date("H:i") . "\n<br />\n"; echo "Det &auml;r f&ouml;r tidigt f&ouml;r att titta p&aring; kursen idag. V&auml;nta till efter klockan 18.\n"; echo "</strong></p>\n";}else{  while($stock=$statement_1->fetchObject()) {	$stock_name[]=$stock->name;	$stock_id[]=$stock->id;  }    if (!isset($stock_name))  {    die("<h3>No stocks to parse found!</h3>");  }  $result=file_get_contents("http://online.wsj.com/mdc/public/page/2_3024-EuropeanStocks_Oslo.html");  if ($result === false) {    echo "FEL!";  }  $i=0;  foreach($stock_name as $a_name) {    echo "<p>Finding: $a_name <br />";	$pattern = "/($a_name)[^0-9]*([0-9,.]*)[^0-9]*([0-9,.]*)[^0-9]*([0-9,.]*)[^0-9]*([0-9,.]*)[^0-9-.]*([0-9,.-]*)/";	preg_match($pattern, $result, $matches);	$volume = substr_replace(str_replace( ',', '',$matches[2]),'.',-3,-3);	$diff = str_replace( '...', '0',$matches[6]);	echo "Name:    $matches[1]<br />";	echo "Volume:  $matches[2]<br />";	echo "High:    $matches[3]<br />";	echo "Low:     $matches[4]<br />";	echo "Close:   $matches[5]<br />";	echo "Net Chg: $diff<br />";	//echo "<pre>$subResult</pre>";	$id = $stock_id[$i];	$i+=1;    $insertSQL = sprintf("INSERT INTO p_ekon_stockvalues (`time`,stock_id,value,high,low,`diff`,volume) VALUES (NOW(), %s, %s, %s, %s, %s, %s)",                       GetSQLValueString($id, "text"),                       GetSQLValueString($matches[5], "double"),                       GetSQLValueString($matches[3], "double"),                       GetSQLValueString($matches[4], "double"),                       GetSQLValueString($matches[6], "double"),                       GetSQLValueString($volume, "double"));    echo "SQL: $insertSQL</p>";	mysql_select_db($database_localhost_lerenius, $localhost_lerenius);    $Result1 = mysql_query($insertSQL, $localhost_lerenius) or die(mysql_error());  }}?></body></html>